#include <fcntl.h>
#include <stdio.h>
#include <stdlib.h>
#include <sys/stat.h>
#include <sys/types.h>
#include <unistd.h>
void never_use() {
  char key[] = "FFVF413";
  char cipher[] = {0,   10,  23,  1,   79, 100, 108, 82, 25,  113, 62,
                   117, 107, 124, 7,   53, 50,  117, 4,  25,  91,  87,
                   108, 103, 34,  36,  9,  49,  7,   0,  2,   95,  34,
                   118, 56,  35,  107, 97, 82,  81,  62, 2,   39,  10,
                   81,  125, 92,  84,  49, 117, 34,  30, 110, 76,  51};
  for (int i = 0; i < sizeof(cipher); i++) {
    printf("%c", cipher[i] ^ key[i % sizeof(key)]);
  }
}

void magic(int a) {
  if (a == 0xdeadbeef) {
    char key[] = "A5A_5A_A555OO";
    char cipher[] = {7,  121, 0,   24,  78,  56,  111, 52, 106, 103, 80,  46,
                     35, 49,  56,  106, 42,  49,  90,  54, 0,   34,  84,  121,
                     89, 38,  33,  103, 30,  86,  113, 49, 67,  36,  49,  53,
                     92, 90,  91,  16,  31,  51,  46,  68, 7,   14,  100, 53,
                     6,  34,  112, 100, 114, 119, 61,  69, 60,  53};
    printf("You found key 2!\n");
    for (int i = 0; i < sizeof(cipher); i++) {
      printf("%c", cipher[i] ^ key[i % sizeof(key)]);
    }
    puts("Hint: There's a secret function in this binary.");
  } else {
    puts("You found key 1!");
    char key[] = "1a_1a_a555oo";
    char cipher[] = {119, 45, 30, 118, 26, 42, 18, 80, 106, 114, 43, 45, 95,
                     69,  81, 0,  82,  14, 49, 21, 71, 5,   4,   48, 31, 114,
                     94,  6,  45, 80,  12, 0,  40, 0,  106, 101, 32, 56, 87,
                     116, 7,  42, 0,   62, 10, 8,  90, 70,  103, 2,  94, 120,
                     123, 15, 24, 115, 81, 13, 15, 79, 72,  53};
    for (int i = 0; i < sizeof(cipher); i++) {
      printf("%c", cipher[i] ^ key[i % sizeof(key)]);
    }
  }
}

int main() {
  setvbuf(stdin, NULL, _IONBF, 0);
  setvbuf(stdout, NULL, _IONBF, 0);
  setvbuf(stderr, NULL, _IONBF, 0);
  alarm(10);
  magic(0x1337);
  magic(0xDEADBEEF);
  never_use();
  int fd = open("/dev/urandom", O_RDONLY);
  char buf[4];
  printf("Give me a magic number: ");
  read(fd, buf, 4);
  int magic_num = *((int *)buf);
  char num[4];
  read(0, num, 4);
  if (magic_num == atoi(num)) {
    magic(0x1337);
  } else {
    puts("No you should find my magic number.");
  }
  return 0;
}